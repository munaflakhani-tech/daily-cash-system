<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Daily Cash System</title>

<style>
body{font-family:Arial;background:#f4f6f9;padding:15px}
h1,h2{text-align:center}
table{border-collapse:collapse;width:100%;background:#fff;margin-bottom:15px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#2c3e50;color:#fff}
input{width:100%;border:none;text-align:center}
.summary{background:#ecf0f1;font-weight:bold}
button{padding:8px 14px;margin:5px;cursor:pointer}
.match{color:green;font-weight:bold}
.notmatch{color:red;font-weight:bold}

@media(max-width:768px){
 th,td{font-size:12px}
}

@media print{
 body{background:#fff}
 button,input[type=date],input[type=month]{display:none}
 input{border:none;font-weight:bold}
 table{page-break-inside:avoid}
}
</style>
</head>

<body>

<h1>Daily Cash Sheet</h1>

Date:
<input type="date" id="datePicker" onchange="loadDay()">

<!-- INCOME -->
<h2>Income</h2>
<button onclick="addRow('incomeTable','income')">Add</button>
<table id="incomeTable">
<tr><th>#</th><th>Description</th><th>Amount</th></tr>
</table>
<table><tr class="summary"><td>Total Income</td><td id="incomeTotal">0</td></tr></table>

<!-- EXPENSE -->
<h2>Outflows</h2>
<button onclick="addRow('expenseTable','expense')">Add</button>
<table id="expenseTable">
<tr><th>#</th><th>Description</th><th>Amount</th></tr>
</table>
<table><tr class="summary"><td>Total Expense</td><td id="expenseTotal">0</td></tr></table>

<!-- DENOMINATION -->
<h2>Denomination</h2>
<table>
<tr><th>Note</th><th>Qty</th><th>Total</th></tr>
<script>
[5000,1000,500,100,50,20,10,1].forEach(n=>{
 document.write(`<tr>
 <td>${n}</td>
 <td><input type="number" class="qty" data-note="${n}"></td>
 <td class="den">${0}</td>
 </tr>`)
})
</script>
<tr class="summary"><td colspan="2">Denomination Total</td><td id="denomTotal">0</td></tr>
</table>

<!-- PENDING -->
<h2>Pending</h2>
<button onclick="addRow('pendingTable','pending')">Add</button>
<table id="pendingTable">
<tr><th>#</th><th>Description</th><th>Amount</th></tr>
</table>
<table><tr class="summary"><td>Total Pending</td><td id="pendingTotal">0</td></tr></table>

<!-- SUMMARY -->
<h2>Summary</h2>
<table>
<tr><td>Opening Balance</td><td><input type="number" id="opening"></td></tr>
<tr><td>Cash In Hand</td><td id="cashInHand">0</td></tr>
<tr><td>Difference</td><td id="difference">0</td></tr>
<tr><td colspan="2" id="status"></td></tr>
</table>

<button onclick="saveDay()">Save</button>
<button onclick="unlock()">Edit</button>
<button onclick="window.print()">Print / PDF</button>

<hr>

<h1>Monthly Report</h1>
<input type="month" id="monthPicker">
<button onclick="generateMonthly()">Generate</button>
<button onclick="exportCSV()">Export Excel</button>

<table id="monthlyTable"></table>

<script>
const PASSWORD="1234";

function addRow(table,cls){
 let t=document.getElementById(table);
 let r=t.insertRow();
 r.innerHTML=`<td>${t.rows.length-1}</td>
 <td><input></td>
 <td><input type="number" class="${cls}"></td>`;
}

function defaultRows(){
 for(let i=0;i<15;i++){
  addRow("incomeTable","income");
  addRow("expenseTable","expense");
  addRow("pendingTable","pending");
 }
}

function sum(cls){
 return [...document.querySelectorAll("."+cls)]
 .reduce((a,b)=>a+(+b.value||0),0);
}

function calc(){
 let income=sum("income"),
 expense=sum("expense"),
 pending=sum("pending"),
 opening=+document.getElementById("opening").value||0;

 incomeTotal.innerText=income;
 expenseTotal.innerText=expense;
 pendingTotal.innerText=pending;

 let cash=opening+income-expense;
 cashInHand.innerText=cash;

 let denom=0;
 document.querySelectorAll(".qty").forEach(q=>{
  let t=(+q.value||0)*(+q.dataset.note);
  q.parentElement.nextElementSibling.innerText=t;
  denom+=t;
 });

 denomTotal.innerText=denom;

 let diff=cash-(denom+pending);
 difference.innerText=diff;
 status.innerHTML=diff===0?
 "<span class='match'>MATCHED</span>":
 "<span class='notmatch'>NOT MATCHED</span>";
}

function lock(state){
 document.querySelectorAll("input").forEach(i=>{
  if(i.id!=="datePicker" && i.id!=="monthPicker")
   i.disabled=state;
 });
}

function saveDay(){
 let d=datePicker.value;
 if(!d) return alert("Select date");

 let pack=(cls)=>[...document.querySelectorAll("."+cls)]
 .map(i=>({desc:i.parentElement.previousElementSibling.firstChild.value,amt:i.value}));

 let data={
  opening:opening.value,
  income:pack("income"),
  expense:pack("expense"),
  pending:pack("pending"),
  denom:[...document.querySelectorAll(".qty")].map(q=>q.value),
  closing:cashInHand.innerText
 };

 localStorage.setItem("cash_"+d,JSON.stringify(data));
 localStorage.setItem("closing_"+d,data.closing);
 lock(true); alert("Saved");
}

function loadDay(){
 let d=datePicker.value;
 if(!d) return;

 document.querySelectorAll("input").forEach(i=>i.value="");

 let prev=new Date(d); prev.setDate(prev.getDate()-1);
 opening.value=localStorage.getItem("closing_"+prev.toISOString().split("T")[0])||0;

 let s=localStorage.getItem("cash_"+d);
 if(s){
  let data=JSON.parse(s);
  opening.value=data.opening;
  ["income","expense","pending"].forEach(cls=>{
   data[cls].forEach((o,i)=>{
    document.querySelectorAll("."+cls)[i].value=o.amt;
    document.querySelectorAll("."+cls)[i].parentElement.previousElementSibling.firstChild.value=o.desc;
   })
  });
  document.querySelectorAll(".qty").forEach((q,i)=>q.value=data.denom[i]||0);
 }
 lock(false); calc();
}

function unlock(){
 if(prompt("Password")==PASSWORD) lock(false);
}

function generateMonthly(){
 let m=monthPicker.value;
 monthlyTable.innerHTML="<tr><th>Date</th><th>Opening</th><th>Income</th><th>Expense</th><th>Pending</th><th>Closing</th></tr>";
 let total={i:0,e:0,p:0};
 Object.keys(localStorage).sort().forEach(k=>{
  if(k.startsWith("cash_")&&k.includes(m)){
   let d=k.replace("cash_","");
   let data=JSON.parse(localStorage.getItem(k));
   let i=data.income.reduce((a,b)=>a+(+b.amt||0),0);
   let e=data.expense.reduce((a,b)=>a+(+b.amt||0),0);
   let p=data.pending.reduce((a,b)=>a+(+b.amt||0),0);
   total.i+=i; total.e+=e; total.p+=p;
   monthlyTable.insertRow().innerHTML=
   `<td>${d}</td><td>${data.opening}</td><td>${i}</td><td>${e}</td><td>${p}</td><td>${data.closing}</td>`;
  }
 });
 monthlyTable.insertRow().innerHTML=
 `<th>Total</th><th></th><th>${total.i}</th><th>${total.e}</th><th>${total.p}</th><th></th>`;
}

function exportCSV(){
 let rows=[...monthlyTable.rows].map(r=>
  [...r.cells].map(c=>c.innerText).join(",")
 ).join("\n");
 let blob=new Blob([rows],{type:"text/csv"});
 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="monthly_cash.csv";
 a.click();
}

document.body.addEventListener("input",calc);
defaultRows(); calc();
</script>

</body>
</html>
